
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Department - Jaheer</title>
  <link rel="stylesheet" th:href="@{/css/table.css}" href="/css/table.css">
</head>
<body>
  <div class="particles">
    <div class="particle" style="width: 120px; height: 120px; left: 10%; top: 20%; animation-delay: 0s;"></div>
    <div class="particle" style="width: 100px; height: 100px; left: 80%; top: 30%; animation-delay: 3s;"></div>
    <div class="particle" style="width: 150px; height: 150px; left: 50%; top: 50%; animation-delay: 6s;"></div>
    <div class="particle" style="width: 90px; height: 90px; left: 20%; top: 70%; animation-delay: 2s;"></div>
    <div class="particle" style="width: 110px; height: 110px; left: 70%; top: 60%; animation-delay: 4s;"></div>
  </div>

  <div class="container">
    <header>
      <h1 id="employee-name">Department Details</h1>
    </header>

    <div class="controls">
      <div style="flex: 1;"></div>
      <a href="/jaheer/employees" class="back-button">‚Üê Back to Employees</a>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Department ID</th>
            <th>Department Name</th>
            <th>Manager ID</th>
          </tr>
        </thead>
        <tbody id="department-table-body">
          <tr><td colspan="3" class="no-data">Loading department...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script th:inline="javascript">
    const apiBaseUrl = /*[[${apiBaseUrl}]]*/ 'http://localhost:9090';
    const params = new URLSearchParams(window.location.search);
    const employeeId = params.get('employeeId');
    const tbody = document.getElementById('department-table-body');
    const heading = document.getElementById('employee-name');

    if (employeeId) {
      fetch(`${apiBaseUrl}/jaheer/departments/by-employee/${employeeId}`)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          return response.json();
        })
        .then(data => {
          tbody.innerHTML = "";
          if (!data || Object.keys(data).length === 0) {
            tbody.innerHTML = `<tr><td colspan="3" class="no-data">No department found for employee ID ${employeeId}</td></tr>`;
            return;
          }

          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${data.id || data.departmentId || 'N/A'}</td>
            <td>${data.departmentName || 'N/A'}</td>
            <td>${data.managerId || 'N/A'}</td>
          `;
          row.onclick = () => {
            alert("Selected Department: " + (data.departmentName || "N/A"));
          };
          tbody.appendChild(row);
        })
        .catch(error => {
          console.error('Error loading department:', error);
          heading.textContent = 'Error loading department data';
          tbody.innerHTML = `<tr><td colspan="3" class="no-data">Failed to load department data</td></tr>`;
        });
    } else {
      heading.textContent = 'No employee selected';
      tbody.innerHTML = `<tr><td colspan="3" class="no-data">Please select an employee from the list</td></tr>`;
    }
  </script>
</body>
</html>